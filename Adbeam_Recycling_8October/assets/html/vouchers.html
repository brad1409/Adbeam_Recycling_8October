<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Adbeam - QR Vouchers</title>
    <link rel="stylesheet" href="index.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      .vouchers-header {
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
        color: white;
        padding: 3rem 0;
        text-align: center;
      }

      .points-display {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        padding: 1rem 2rem;
        display: inline-block;
        margin-top: 1rem;
      }

      .points-value {
        font-size: 2rem;
        font-weight: 700;
      }

      .voucher-tabs {
        background: white;
        border-bottom: 1px solid #e5e7eb;
        position: sticky;
        top: 80px;
        z-index: 100;
      }

      .tab-content {
        padding: 2rem 0;
      }

      .voucher-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .voucher-template-card {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
        transition: all 0.3s ease;
        position: relative;
      }

      .voucher-template-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
      }

      .voucher-header {
        padding: 1.5rem;
        background: linear-gradient(135deg, #f8fafc, #f1f5f9);
        border-bottom: 1px solid #e5e7eb;
      }

      .voucher-icon {
        width: 48px;
        height: 48px;
        background: #2563eb;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        margin-bottom: 1rem;
      }

      .voucher-title {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: #1f2937;
      }

      .voucher-vendor {
        color: #6b7280;
        font-size: 0.875rem;
        font-weight: 500;
      }

      .voucher-body {
        padding: 1.5rem;
      }

      .voucher-description {
        color: #4b5563;
        margin-bottom: 1rem;
        line-height: 1.5;
      }

      .voucher-details {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .voucher-discount {
        font-size: 1.125rem;
        font-weight: 600;
        color: #059669;
      }

      .voucher-points {
        font-size: 1rem;
        font-weight: 600;
        color: #2563eb;
      }

      .generate-btn {
        width: 100%;
        padding: 0.75rem;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .generate-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .my-voucher-card {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
        margin-bottom: 1.5rem;
      }

      .voucher-qr-section {
        padding: 1.5rem;
        text-align: center;
        background: #f8fafc;
        border-bottom: 1px solid #e5e7eb;
      }

      .qr-code-container {
        display: inline-block;
        padding: 1rem;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .qr-code-image {
        width: 200px;
        height: 200px;
        border-radius: 8px;
      }

      .voucher-code {
        font-family: 'Courier New', monospace;
        font-size: 1.125rem;
        font-weight: 600;
        color: #1f2937;
        margin-top: 1rem;
        padding: 0.5rem 1rem;
        background: #e5e7eb;
        border-radius: 6px;
        display: inline-block;
      }

      .voucher-info {
        padding: 1.5rem;
      }

      .voucher-status {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .status-active {
        background: #dcfce7;
        color: #166534;
      }

      .status-redeemed {
        background: #dbeafe;
        color: #1e40af;
      }

      .status-expired {
        background: #fee2e2;
        color: #991b1b;
      }

      .voucher-expiry {
        color: #6b7280;
        font-size: 0.875rem;
        margin-top: 0.5rem;
      }

      .expiry-warning {
        color: #dc2626;
        font-weight: 600;
      }

      .loading-spinner {
        width: 20px;
        height: 20px;
        border: 2px solid #ffffff;
        border-top: 2px solid transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 0.5rem;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .filter-section {
        background: white;
        padding: 1rem 0;
        border-bottom: 1px solid #e5e7eb;
      }

      .filter-controls {
        display: flex;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
      }

      .filter-select {
        padding: 0.5rem 1rem;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        background: white;
        min-width: 150px;
      }

      .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: #6b7280;
      }

      .empty-state-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
      }

      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1050;
      }

      .toast {
        background: white;
        border-radius: 8px;
        box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
        min-width: 300px;
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="container header-content">
        <a href="index.html" class="logo">
          <div class="logo-icon">A</div>
          Adbeam
        </a>
        <nav>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="dashboard.html">Recycling Tracker</a></li>
            <li><a href="recycling_guide.html">Recycling Guide</a></li>
            <li><a href="qr-scanner.html">QR Scanner</a></li>
            <li><a href="vouchers.html" class="active">Vouchers</a></li>
            <li><a href="leaderboard.html">Leaderboard</a></li>
            <li><a href="about.html">About</a></li>
          </ul>
        </nav>
        <div class="auth-buttons"></div>
      </div>
    </header>

    <div class="vouchers-header">
      <div class="container">
        <h1><i class="fas fa-qrcode"></i> QR Vouchers</h1>
        <p>Generate QR code vouchers and redeem them at participating stores</p>
        <div class="points-display">
          <div class="points-value" id="userPoints">1,247</div>
          <div>Available Points</div>
        </div>
      </div>
    </div>

    <div class="voucher-tabs">
      <div class="container">
        <ul class="nav nav-tabs" id="voucherTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="available-tab" data-bs-toggle="tab" data-bs-target="#available" type="button" role="tab">
              Available Vouchers
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="my-vouchers-tab" data-bs-toggle="tab" data-bs-target="#my-vouchers" type="button" role="tab">
              My Vouchers <span class="badge bg-primary ms-1" id="myVouchersCount">0</span>
            </button>
          </li>
        </ul>
      </div>
    </div>

    <div class="container">
      <div class="tab-content" id="voucherTabContent">
        <!-- Available Vouchers Tab -->
        <div class="tab-pane fade show active" id="available" role="tabpanel">
          <div class="filter-section">
            <div class="filter-controls">
              <select class="filter-select" id="categoryFilter">
                <option value="all">All Categories</option>
              </select>
              <select class="filter-select" id="pointsFilter">
                <option value="all">All Points</option>
                <option value="0-200">0-200 points</option>
                <option value="201-500">201-500 points</option>
                <option value="501-1000">501-1000 points</option>
                <option value="1000+">1000+ points</option>
              </select>
            </div>
          </div>

          <div class="voucher-grid" id="availableVouchersGrid">
            <!-- Available voucher templates will be loaded here -->
          </div>
        </div>

        <!-- My Vouchers Tab -->
        <div class="tab-pane fade" id="my-vouchers" role="tabpanel">
          <div class="filter-section">
            <div class="filter-controls">
              <select class="filter-select" id="statusFilter">
                <option value="all">All Status</option>
                <option value="active">Active</option>
                <option value="redeemed">Redeemed</option>
                <option value="expired">Expired</option>
              </select>
            </div>
          </div>

          <div id="myVouchersContainer">
            <!-- User's vouchers will be loaded here -->
          </div>
        </div>
      </div>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <!-- Voucher Details Modal -->
    <div class="modal fade" id="voucherModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="voucherModalTitle">Voucher Details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body" id="voucherModalBody">
            <!-- Voucher details will be loaded here -->
          </div>
        </div>
      </div>
    </div>

    <footer>
      <div class="container">
        <div class="footer-content">
          <div class="footer-column footer-about">
            <a href="index.html" class="logo">
              <div class="logo-icon">A</div>
              Adbeam
            </a>
            <p>
              Rewarding sustainable choices on college campuses across the
              nation.
            </p>
          </div>
          <div class="footer-column">
            <h3>Product</h3>
            <ul class="footer-links">
              <li><a href="dashboard.html">Recycling Tracker</a></li>
              <li><a href="recycling_guide.html">Recycling Guide</a></li>
              <li><a href="vouchers.html">Vouchers</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h3>Company</h3>
            <ul class="footer-links">
              <li><a href="about.html">About us</a></li>
              <li><a href="contact.html">Contact</a></li>
              <li><a href="#">Careers</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h3>Resources</h3>
            <ul class="footer-links">
              <li><a href="#">Support</a></li>
              <li><a href="#">Privacy</a></li>
              <li><a href="#">Terms</a></li>
            </ul>
          </div>
        </div>
        <div class="footer-bottom">
          <p class="copyright">© 2025 Adbeam, Inc. All rights reserved.</p>
          <div class="social-links">
            <a href="#" class="social-link">
              <i class="fab fa-facebook-f"></i>
            </a>
            <a href="#" class="social-link">
              <i class="fab fa-twitter"></i>
            </a>
            <a href="#" class="social-link">
              <i class="fab fa-linkedin-in"></i>
            </a>
          </div>
        </div>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="index.js"></script>
    <script>
      class VoucherSystem {
        constructor() {
          this.userPoints = 1247;
          this.voucherTemplates = [];
          this.userVouchers = [];
          this.categories = [];

          this.initializeElements();
          this.loadUserData();
          this.loadCategories();
          this.loadVoucherTemplates();
          this.loadUserVouchers();
          this.setupEventListeners();
        }

        initializeElements() {
          this.pointsDisplay = document.getElementById('userPoints');
          this.availableGrid = document.getElementById('availableVouchersGrid');
          this.myVouchersContainer = document.getElementById('myVouchersContainer');
          this.categoryFilter = document.getElementById('categoryFilter');
          this.pointsFilter = document.getElementById('pointsFilter');
          this.statusFilter = document.getElementById('statusFilter');
          this.myVouchersCount = document.getElementById('myVouchersCount');
          this.toastContainer = document.getElementById('toastContainer');
        }

        async loadUserData() {
          try {
            // Mock user data - in production, fetch from API
            this.userPoints = 1247;
            this.updatePointsDisplay();
          } catch (error) {
            console.error('Failed to load user data:', error);
          }
        }

        async loadCategories() {
          try {
            // Mock categories - in production, fetch from API
            this.categories = [
              { name: 'Dining', icon_class: 'fas fa-utensils' },
              { name: 'Coffee & Snacks', icon_class: 'fas fa-coffee' },
              { name: 'Campus Store', icon_class: 'fas fa-store' },
              { name: 'Transportation', icon_class: 'fas fa-bus' },
              { name: 'Entertainment', icon_class: 'fas fa-ticket-alt' }
            ];

            // Populate category filter
            this.categoryFilter.innerHTML = '<option value="all">All Categories</option>';
            this.categories.forEach(category => {
              const option = document.createElement('option');
              option.value = category.name;
              option.textContent = category.name;
              this.categoryFilter.appendChild(option);
            });
          } catch (error) {
            console.error('Failed to load categories:', error);
          }
        }

        async loadVoucherTemplates() {
          try {
            // Mock voucher templates - in production, fetch from API
            this.voucherTemplates = [
              {
                template_id: 1,
                name: 'Free Coffee Voucher',
                description: 'Get a free regular coffee from campus café',
                discount_type: 'free_item',
                discount_value: 0,
                points_cost: 200,
                category: 'Coffee & Snacks',
                vendor_name: 'Campus Café',
                icon_class: 'fas fa-coffee',
                terms_conditions: 'Valid for one regular coffee. Cannot be combined with other offers.',
                valid_days: 14
              },
              {
                template_id: 2,
                name: '10% Off Dining',
                description: '10% discount on any dining hall purchase',
                discount_type: 'percentage',
                discount_value: 10,
                points_cost: 300,
                category: 'Dining',
                vendor_name: 'Campus Dining',
                icon_class: 'fas fa-utensils',
                terms_conditions: 'Valid at all campus dining locations. Minimum purchase $5.',
                valid_days: 30
              },
              {
                template_id: 3,
                name: '$5 Campus Store Credit',
                description: '$5 off any campus store purchase',
                discount_type: 'fixed_amount',
                discount_value: 5,
                points_cost: 400,
                category: 'Campus Store',
                vendor_name: 'Campus Bookstore',
                icon_class: 'fas fa-store',
                terms_conditions: 'Valid on textbooks, supplies, and merchandise. Minimum purchase $10.',
                valid_days: 60
              },
              {
                template_id: 4,
                name: 'Free Parking Day',
                description: 'One day of free campus parking',
                discount_type: 'free_item',
                discount_value: 0,
                points_cost: 150,
                category: 'Transportation',
                vendor_name: 'Campus Parking',
                icon_class: 'fas fa-parking',
                terms_conditions: 'Valid for one day in any student parking lot.',
                valid_days: 7
              },
              {
                template_id: 5,
                name: '20% Off Campus Events',
                description: '20% discount on campus event tickets',
                discount_type: 'percentage',
                discount_value: 20,
                points_cost: 500,
                category: 'Entertainment',
                vendor_name: 'Campus Events',
                icon_class: 'fas fa-ticket-alt',
                terms_conditions: 'Valid for most campus events. Some restrictions may apply.',
                valid_days: 45
              }
            ];

            this.renderAvailableVouchers();
          } catch (error) {
            console.error('Failed to load voucher templates:', error);
            this.showToast('Failed to load available vouchers', 'error');
          }
        }

        async loadUserVouchers() {
          try {
            // Mock user vouchers - in production, fetch from API
            this.userVouchers = [
              {
                voucher_id: 1,
                template_name: 'Free Coffee Voucher',
                voucher_code: 'COFFEE123ABC',
                status: 'active',
                discount_type: 'free_item',
                discount_value: 0,
                vendor_name: 'Campus Café',
                qr_code_image_url: 'https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl=COFFEE123ABC',
                generated_at: '2025-01-25T10:00:00Z',
                expires_at: '2025-02-08T23:59:59Z',
                days_until_expiry: 14,
                terms_conditions: 'Valid for one regular coffee. Cannot be combined with other offers.'
              },
              {
                voucher_id: 2,
                template_name: '10% Off Dining',
                voucher_code: 'DINING456DEF',
                status: 'redeemed',
                discount_type: 'percentage',
                discount_value: 10,
                vendor_name: 'Campus Dining',
                qr_code_image_url: 'https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl=DINING456DEF',
                generated_at: '2025-01-20T14:00:00Z',
                expires_at: '2025-02-19T23:59:59Z',
                redeemed_at: '2025-01-22T12:30:00Z',
                terms_conditions: 'Valid at all campus dining locations. Minimum purchase $5.'
              }
            ];

            this.renderUserVouchers();
            this.updateVoucherCount();
          } catch (error) {
            console.error('Failed to load user vouchers:', error);
            this.showToast('Failed to load your vouchers', 'error');
          }
        }

        renderAvailableVouchers() {
          const filteredTemplates = this.getFilteredTemplates();

          if (filteredTemplates.length === 0) {
            this.availableGrid.innerHTML = `
              <div class="empty-state">
                <div class="empty-state-icon">
                  <i class="fas fa-qrcode"></i>
                </div>
                <h3>No vouchers available</h3>
                <p>Check back later for new voucher offers!</p>
              </div>
            `;
            return;
          }

          this.availableGrid.innerHTML = filteredTemplates.map(template => `
            <div class="voucher-template-card" data-category="${template.category}" data-points="${template.points_cost}">
              <div class="voucher-header">
                <div class="voucher-icon">
                  <i class="${template.icon_class}"></i>
                </div>
                <h3 class="voucher-title">${template.name}</h3>
                <div class="voucher-vendor">${template.vendor_name}</div>
              </div>
              <div class="voucher-body">
                <p class="voucher-description">${template.description}</p>
                <div class="voucher-details">
                  <div class="voucher-discount">
                    ${this.formatDiscount(template.discount_type, template.discount_value)}
                  </div>
                  <div class="voucher-points">${template.points_cost} points</div>
                </div>
                <button 
                  class="btn btn-primary generate-btn" 
                  data-template-id="${template.template_id}"
                  ${this.userPoints < template.points_cost ? 'disabled' : ''}
                >
                  ${this.userPoints < template.points_cost ? 'Not enough points' : 'Generate Voucher'}
                </button>
              </div>
            </div>
          `).join('');

          // Add event listeners to generate buttons
          this.availableGrid.querySelectorAll('.generate-btn').forEach(btn => {
            btn.addEventListener('click', (e) => this.handleGenerateVoucher(e));
          });
        }

        renderUserVouchers() {
          const filteredVouchers = this.getFilteredUserVouchers();

          if (filteredVouchers.length === 0) {
            this.myVouchersContainer.innerHTML = `
              <div class="empty-state">
                <div class="empty-state-icon">
                  <i class="fas fa-ticket-alt"></i>
                </div>
                <h3>No vouchers yet</h3>
                <p>Generate your first voucher from the Available Vouchers tab!</p>
              </div>
            `;
            return;
          }

          this.myVouchersContainer.innerHTML = filteredVouchers.map(voucher => `
            <div class="my-voucher-card">
              <div class="voucher-qr-section">
                <div class="qr-code-container">
                  <img src="${voucher.qr_code_image_url}" alt="QR Code" class="qr-code-image">
                </div>
                <div class="voucher-code">${voucher.voucher_code}</div>
              </div>
              <div class="voucher-info">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <h4>${voucher.template_name}</h4>
                  <span class="voucher-status status-${voucher.status}">${voucher.status}</span>
                </div>
                <p class="text-muted mb-2">${voucher.vendor_name}</p>
                <div class="voucher-discount mb-2">
                  ${this.formatDiscount(voucher.discount_type, voucher.discount_value)}
                </div>
                <div class="voucher-expiry">
                  ${this.formatExpiryInfo(voucher)}
                </div>
                ${voucher.status === 'active' ? `
                  <div class="mt-3">
                    <button class="btn btn-outline-primary btn-sm me-2" onclick="voucherSystem.showVoucherDetails('${voucher.voucher_code}')">
                      View Details
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="voucherSystem.shareVoucher('${voucher.voucher_code}')">
                      Share
                    </button>
                  </div>
                ` : ''}
              </div>
            </div>
          `).join('');
        }

        getFilteredTemplates() {
          let filtered = [...this.voucherTemplates];

          // Category filter
          const category = this.categoryFilter.value;
          if (category !== 'all') {
            filtered = filtered.filter(template => template.category === category);
          }

          // Points filter
          const pointsRange = this.pointsFilter.value;
          if (pointsRange !== 'all') {
            const [min, max] = pointsRange.split('-').map(p => p.replace('+', ''));
            filtered = filtered.filter(template => {
              if (pointsRange === '1000+') {
                return template.points_cost >= 1000;
              }
              return template.points_cost >= parseInt(min) && template.points_cost <= parseInt(max);
            });
          }

          return filtered;
        }

        getFilteredUserVouchers() {
          let filtered = [...this.userVouchers];

          // Status filter
          const status = this.statusFilter.value;
          if (status !== 'all') {
            filtered = filtered.filter(voucher => voucher.status === status);
          }

          return filtered.sort((a, b) => new Date(b.generated_at) - new Date(a.generated_at));
        }

        async handleGenerateVoucher(e) {
          const btn = e.target;
          const templateId = parseInt(btn.dataset.templateId);
          const template = this.voucherTemplates.find(t => t.template_id === templateId);

          if (!template) return;

          // Confirm generation
          if (!confirm(`Generate "${template.name}" voucher for ${template.points_cost} points?`)) {
            return;
          }

          // Set loading state
          btn.disabled = true;
          btn.innerHTML = '<div class="loading-spinner"></div>Generating...';

          try {
            // Simulate API call
            await new Promise(resolve => setTimeout(resolve, 2000));

            // Mock successful generation
            const voucherCode = this.generateVoucherCode();
            const newVoucher = {
              voucher_id: Date.now(),
              template_name: template.name,
              voucher_code: voucherCode,
              status: 'active',
              discount_type: template.discount_type,
              discount_value: template.discount_value,
              vendor_name: template.vendor_name,
              qr_code_image_url: `https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl=${voucherCode}`,
              generated_at: new Date().toISOString(),
              expires_at: new Date(Date.now() + (template.valid_days * 24 * 60 * 60 * 1000)).toISOString(),
              days_until_expiry: template.valid_days,
              terms_conditions: template.terms_conditions
            };

            // Update user points
            this.userPoints -= template.points_cost;
            this.updatePointsDisplay();

            // Add to user vouchers
            this.userVouchers.unshift(newVoucher);

            // Show success message
            this.showToast(`Successfully generated "${template.name}" voucher!`, 'success');

            // Re-render components
            this.renderAvailableVouchers();
            this.renderUserVouchers();
            this.updateVoucherCount();

            // Switch to My Vouchers tab
            const myVouchersTab = document.getElementById('my-vouchers-tab');
            const tab = new bootstrap.Tab(myVouchersTab);
            tab.show();

          } catch (error) {
            console.error('Voucher generation failed:', error);
            this.showToast('Voucher generation failed. Please try again.', 'error');
          } finally {
            // Reset button state
            btn.disabled = false;
            btn.innerHTML = 'Generate Voucher';
          }
        }

        generateVoucherCode() {
          const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
          let result = '';
          for (let i = 0; i < 12; i++) {
            result += chars.charAt(Math.floor(Math.random() * chars.length));
          }
          return result;
        }

        formatDiscount(type, value) {
          switch (type) {
            case 'percentage':
              return `${value}% OFF`;
            case 'fixed_amount':
              return `$${value} OFF`;
            case 'free_item':
              return 'FREE';
            default:
              return 'DISCOUNT';
          }
        }

        formatExpiryInfo(voucher) {
          if (voucher.status === 'redeemed') {
            return `Redeemed on ${new Date(voucher.redeemed_at).toLocaleDateString()}`;
          }
          
          if (voucher.status === 'expired') {
            return `Expired on ${new Date(voucher.expires_at).toLocaleDateString()}`;
          }

          const daysLeft = voucher.days_until_expiry;
          if (daysLeft <= 3) {
            return `<span class="expiry-warning">Expires in ${daysLeft} day${daysLeft !== 1 ? 's' : ''}</span>`;
          }
          
          return `Expires on ${new Date(voucher.expires_at).toLocaleDateString()}`;
        }

        showVoucherDetails(voucherCode) {
          const voucher = this.userVouchers.find(v => v.voucher_code === voucherCode);
          if (!voucher) return;

          const modal = document.getElementById('voucherModal');
          const title = document.getElementById('voucherModalTitle');
          const body = document.getElementById('voucherModalBody');

          title.textContent = voucher.template_name;
          body.innerHTML = `
            <div class="text-center mb-4">
              <img src="${voucher.qr_code_image_url}" alt="QR Code" class="qr-code-image">
              <div class="voucher-code mt-2">${voucher.voucher_code}</div>
            </div>
            <div class="row">
              <div class="col-md-6">
                <h6>Vendor</h6>
                <p>${voucher.vendor_name}</p>
              </div>
              <div class="col-md-6">
                <h6>Discount</h6>
                <p>${this.formatDiscount(voucher.discount_type, voucher.discount_value)}</p>
              </div>
              <div class="col-md-6">
                <h6>Status</h6>
                <p><span class="voucher-status status-${voucher.status}">${voucher.status}</span></p>
              </div>
              <div class="col-md-6">
                <h6>Expires</h6>
                <p>${new Date(voucher.expires_at).toLocaleDateString()}</p>
              </div>
            </div>
            <div class="mt-3">
              <h6>Terms & Conditions</h6>
              <p class="text-muted small">${voucher.terms_conditions}</p>
            </div>
          `;

          const bsModal = new bootstrap.Modal(modal);
          bsModal.show();
        }

        shareVoucher(voucherCode) {
          if (navigator.share) {
            navigator.share({
              title: 'Adbeam Voucher',
              text: `Check out my voucher: ${voucherCode}`,
              url: window.location.href
            });
          } else {
            // Fallback: copy to clipboard
            navigator.clipboard.writeText(voucherCode).then(() => {
              this.showToast('Voucher code copied to clipboard!', 'success');
            });
          }
        }

        updatePointsDisplay() {
          this.pointsDisplay.textContent = this.userPoints.toLocaleString();
        }

        updateVoucherCount() {
          const activeCount = this.userVouchers.filter(v => v.status === 'active').length;
          this.myVouchersCount.textContent = activeCount;
        }

        showToast(message, type = 'info') {
          const toastId = 'toast-' + Date.now();
          const bgColor = type === 'success' ? 'bg-success' : type === 'error' ? 'bg-danger' : 'bg-info';

          const toastHTML = `
            <div class="toast show" id="${toastId}" role="alert">
              <div class="toast-header ${bgColor} text-white">
                <strong class="me-auto">
                  <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                  ${type === 'success' ? 'Success' : type === 'error' ? 'Error' : 'Info'}
                </strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
              </div>
              <div class="toast-body">
                ${message}
              </div>
            </div>
          `;

          this.toastContainer.insertAdjacentHTML('beforeend', toastHTML);

          // Auto remove after 5 seconds
          setTimeout(() => {
            const toast = document.getElementById(toastId);
            if (toast) {
              toast.remove();
            }
          }, 5000);
        }

        setupEventListeners() {
          // Filter event listeners
          this.categoryFilter.addEventListener('change', () => this.renderAvailableVouchers());
          this.pointsFilter.addEventListener('change', () => this.renderAvailableVouchers());
          this.statusFilter.addEventListener('change', () => this.renderUserVouchers());
        }
      }

      // Initialize voucher system when page loads
      let voucherSystem;
      document.addEventListener('DOMContentLoaded', () => {
        voucherSystem = new VoucherSystem();
      });
    </script>
  </body>
</html>
